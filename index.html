<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excel Glass Tabs - Pinch Zoom Content Only</title>

<style>
/* ====== GLOBAL ======= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: system-ui, sans-serif;
}

body {
  height: 100vh;
  background: #d3d3d3;
  /* padding atas kecil, bawah 56px supaya berhenti di atas nav bar HP */
  padding: 2px 0 56px;
}

/* ====== WRAPPER ======= */
.excel-wrapper {
  width: 100vw;
  /* tinggi dikurangi ‚Äúruang nav‚Äù 56px */
  height: calc(100vh - 56px);
  margin: auto;
  display: flex;
  flex-direction: column;
  border-radius: 10px;
  overflow: hidden;

  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
}

/* TITLE BAR TIPIS */
.title-bar {
  height: 4px;
  transition: background 0.3s;
}

/* CONTENT AREA */
.content-area {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* Area scroll + pinch-zoom di dalamnya */
.inner-content {
  flex: 1;
  padding: 16px;
  overflow: auto;                 /* saat di-zoom bisa di-scroll */
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(18px);
  position: relative;
  touch-action: none;             /* penting untuk custom pinch */
}

/* Wrapper yang di-zoom (hanya isi ini yang membesar) */
.zoom-wrapper {
  transform-origin: top left;
}

/* ====== TAB BAR ======= */
.sheet-tabs-bar {
  height: 60px;
  display: flex;
  align-items: flex-end;
  transition: background 0.25s;
}

/* ====== TAB BUTTON ======= */
.sheet-tab {
  width: 25%;
  padding: 14px 10px;
  text-align: center;
  font-size: 13px;
  line-height: 15px;
  cursor: pointer;
  background: rgba(255,255,255,0.5);
  border: none;
  color: #000;
  margin-top: 10px;
  transition: 0.15s;
  border-radius: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.sheet-tab:hover {
  background: rgba(255,255,255,0.85);
}

.sheet-tab.active {
  color: white;
  font-weight: 700;
  transform: translateY(-3px);
  background: var(--activeColor);
  border-radius: 12px 12px 0 0;
  box-shadow: 0 0 18px var(--glowColor);
}

/* ====== SLIDE ANIMATION ======= */
.slide-from-right { animation: slideFromRight .28s ease-out; }
.slide-from-left  { animation: slideFromLeft .28s ease-out; }

@keyframes slideFromRight {
  from { opacity:0; transform:translateX(40px); }
  to   { opacity:1; transform:translateX(0); }
}
@keyframes slideFromLeft {
  from { opacity:0; transform:translateX(-40px); }
  to   { opacity:1; transform:translateX(0); }
}

/* ===========================================================
   üì± RESPONSIVE UNTUK SMARTPHONE
=========================================================== */
@media (max-width: 600px) {

  body {
    /* di HP, jangan ada padding samping; tetap sisakan ruang bawah 56px */
    padding: 0 0 56px;
  }

  .excel-wrapper {
    border-radius: 0;
    height: calc(100vh - 56px);
  }

  .inner-content { padding: 10px; }

  .sheet-tabs-bar { height: 48px; }

  .sheet-tab {
    padding: 10px 4px;
    font-size: 11px;
    line-height: 13px;
  }

  .sheet-tab.active {
    transform: translateY(-2px);
    border-radius: 10px 10px 0 0;
  }
}
</style>
</head>
<body>

<div class="excel-wrapper">

  <div class="title-bar" id="colorBar"></div>

  <div class="content-area">

    <div class="inner-content" id="innerContent">
      <!-- YANG DI-ZOOM HANYA BAGIAN INI -->
      <div class="zoom-wrapper" id="zoomWrapper">
        <div id="contentArea">Memuat...</div>
      </div>
    </div>

    <div class="title-bar" id="colorBar2"></div>

    <div class="sheet-tabs-bar" id="tabsBar">

      <div class="sheet-tab active" data-file="halaman1.html" data-color="#107C41">
        KRN<br>Bu Azmil
      </div>

      <div class="sheet-tab" data-file="halaman2.html" data-color="#2F5597">
        KRN<br>Hexing
      </div>

      <div class="sheet-tab" data-file="halaman3.html" data-color="#C55A11">
        KRN<br>Sanxing
      </div>

      <div class="sheet-tab" data-file="halaman4.html" data-color="#7030A0">
        Admin<br>login
      </div>

    </div>
  </div>

</div>

<script>
/* ==========================================================
   FAST MODE + OFFLINE CACHE + SYNC ONLINE
========================================================== */

const tabs = document.querySelectorAll(".sheet-tab");
const contentArea = document.getElementById("contentArea");
const colorBar = document.getElementById("colorBar");
const colorBar2 = document.getElementById("colorBar2");
const tabsBar = document.getElementById("tabsBar");
const innerContent = document.getElementById("innerContent");
const zoomWrapper = document.getElementById("zoomWrapper");

let cachedPages = {};
let currentIndex = 0;

const FILES = {
  0: "halaman1.html",
  1: "halaman2.html",
  2: "halaman3.html",
  3: "halaman4.html"
};

/* ===== helper untuk memasukkan HTML + menjalankan <script> ===== */
function injectHtmlWithScripts(target, html) {
  const tmp = document.createElement("div");
  tmp.innerHTML = html;

  const scriptNodes = Array.from(tmp.querySelectorAll("script"));
  // hapus script dari fragment
  scriptNodes.forEach(s => s.parentNode.removeChild(s));

  // masukkan HTML tanpa script
  target.innerHTML = "";
  while (tmp.firstChild) {
    target.appendChild(tmp.firstChild);
  }

  // jalankan script satu per satu
  scriptNodes.forEach(oldScript => {
    const newScript = document.createElement("script");
    // copy attribute (src, type, dll)
    Array.from(oldScript.attributes).forEach(attr => {
      newScript.setAttribute(attr.name, attr.value);
    });
    // copy isi
    newScript.textContent = oldScript.textContent;
    // append ke target (atau document.body); di sini ke target
    target.appendChild(newScript);
  });
}

/* PRELOAD ALL */
async function preloadAllPages() {
  for (let i = 0; i < 4; i++) {
    const file = FILES[i];

    try {
      const res = await fetch(file);
      const html = await res.text();
      cachedPages[file] = html;
      localStorage.setItem("page_" + file, html);
    } catch {
      const local = localStorage.getItem("page_" + file);
      if (local) cachedPages[file] = local;
    }
  }
}

/* LOAD FROM CACHE + jalankan script */
function loadPageFromCache(file, direction) {
  const html = cachedPages[file] || "<p>Tidak bisa memuat halaman.</p>";

  injectHtmlWithScripts(contentArea, html);   // <-- perbedaan utama

  zoomWrapper.classList.remove("slide-from-right","slide-from-left");
  void zoomWrapper.offsetWidth;
  zoomWrapper.classList.add(
    direction === "right" ? "slide-from-right" : "slide-from-left"
  );
}

/* APPLY THEME */
function applyTheme(tab) {
  const color = tab.dataset.color;
  const glow = color + "88";
  tab.style.setProperty("--activeColor", color);
  tab.style.setProperty("--glowColor", glow);

  tabsBar.style.background = color;
  colorBar.style.background = color;
  colorBar2.style.background = color;
}

/* RADIUS LOGIC */
function applyRadius(index) {
  tabs.forEach(t => t.style.borderRadius = "0");

  if (index === 0) {
    tabs[1].style.borderRadius = "10px 0 0 0";
  }
  else if (index === 1) {
    tabs[0].style.borderRadius = "0 10px 0 0";
    tabs[2].style.borderRadius = "10px 0 0 0";
  }
  else if (index === 2) {
    tabs[1].style.borderRadius = "0 10px 0 0";
    tabs[3].style.borderRadius = "10px 0 0 0";
  }
  else if (index === 3) {
    tabs[2].style.borderRadius = "0 10px 0 0";
  }
}

/* SYNC ONLINE */
window.addEventListener("online", preloadAllPages);

/* INIT */
(async () => {
  await preloadAllPages();
  applyTheme(tabs[0]);
  applyRadius(0);
  loadPageFromCache(FILES[0], "right");
})();

/* TAB CLICK */
tabs.forEach((tab, index) => {
  tab.addEventListener("click", () => {
    if (index === currentIndex) return;

    const direction = index > currentIndex ? "right" : "left";
    const file = FILES[index];

    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");

    applyTheme(tab);
    applyRadius(index);
    loadPageFromCache(file, direction);

    currentIndex = index;
  });
});

/* ==========================================================
   PINCH-TO-ZOOM HANYA UNTUK ISI HALAMAN
========================================================== */

let currentScale = 1;
let startScale = 1;
let startDistance = 0;
const minScale = 0.7;
const maxScale = 1.8;

function distance(t1, t2) {
  const dx = t2.clientX - t1.clientX;
  const dy = t2.clientY - t1.clientY;
  return Math.hypot(dx, dy);
}

function applyZoom() {
  zoomWrapper.style.transform = `scale(${currentScale})`;
}

innerContent.addEventListener("touchstart", (e) => {
  if (e.touches.length === 2) {
    e.preventDefault();
    startDistance = distance(e.touches[0], e.touches[1]);
    startScale = currentScale;
  }
}, { passive: false });

innerContent.addEventListener("touchmove", (e) => {
  if (e.touches.length === 2) {
    e.preventDefault();
    const newDistance = distance(e.touches[0], e.touches[1]);
    const factor = newDistance / startDistance;
    currentScale = Math.min(maxScale, Math.max(minScale, startScale * factor));
    applyZoom();
  }
}, { passive: false });

/* set awal */
applyZoom();
</script>

</body>
</html>
